#!/bin/bash -e
set -e -x

RUN_DIR=/var/vcap/packages/benchmark-bbs/src/code.cloudfoundry.org/benchmarkbbs
LOG_DIR=/var/vcap/sys/log/benchmark-bbs
CONF_DIR=/var/vcap/jobs/benchmark-bbs/config


export GOROOT=$(readlink -nf /var/vcap/packages/golang)
export PATH=${GOROOT}/bin:${PATH}

export GOPATH=/var/vcap/packages/benchmark-bbs
export PATH=${GOPATH}/bin:${PATH}

export CF_COLOR=false

mkdir -p $LOG_DIR
chown -R vcap:vcap $LOG_DIR


# Work around for GOLANG 1.5.3 DNS bug
export GODEBUG=netdns=cgo

ginkgo \
    -config=$CONF_DIR/benchmark.json \
    1> >(tee -a $LOG_DIR/benchmark-bbs.stdout.log) 
